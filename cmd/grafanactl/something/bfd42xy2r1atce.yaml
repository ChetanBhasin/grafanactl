annotations:
  description: "StatefulSet {{ $labels.statefulset }} in namespace {{ $labels.namespace }} has {{ printf \"%.0f\" $values.B.Value }} total container restarts in the last hour (threshold: >10). OOMKilled pods are excluded. This alert is suppressed when rollup is down."
  runbook_url: "https://github.com/zetamarkets/terraform-infrastructure/wiki/Runbooks#high-pod-restart-count"
  summary: StatefulSet has high restart count in mainnet
condition: C
data:
  - datasourceUid: victoria-metrics-mainnet
    model:
      editorMode: code
      expr: "sum by (statefulset, namespace) (\n  label_replace(\n    (\n      increase(kube_pod_container_status_restarts_total{namespace=~\"applications|hyperlane\"}[1h])\n      unless on (pod, namespace)\n      kube_pod_container_status_last_terminated_reason{reason=\"OOMKilled\", namespace=~\"applications|hyperlane\"}\n    )\n    * on (pod, namespace) group_left(created_by_name)\n    kube_pod_info{created_by_kind=\"StatefulSet\", namespace=~\"applications|hyperlane\"},\n    \"statefulset\", \"$1\", \"created_by_name\", \"(.*)\"\n  )\n)\nunless on() (\n  # Rollup unhealthy - suppress dependent alerts\n  (kube_statefulset_replicas{statefulset=~\"rollup.*\", namespace=\"applications\"}\n   - on(statefulset, namespace) kube_statefulset_status_replicas_available{statefulset=~\"rollup.*\", namespace=\"applications\"}) > 0\n  or\n  (kube_deployment_status_replicas_unavailable{deployment=~\"rollup.*\", namespace=\"applications\"} > 0)\n)\n"
      intervalMs: 15000.0
      maxDataPoints: 1000.0
      refId: A
    refId: A
    relativeTimeRange:
      from: 3600
  - datasourceUid: __expr__
    model:
      datasource:
        type: __expr__
        uid: __expr__
      expression: A
      intervalMs: 1000.0
      maxDataPoints: 43200.0
      reducer: last
      refId: B
      settings:
        mode: dropNN
      type: reduce
    refId: B
    relativeTimeRange: {}
  - datasourceUid: __expr__
    model:
      conditions:
        - evaluator:
            params:
              - 10.0
            type: gt
          unloadEvaluator:
            params:
              - 10.0
            type: lt
      datasource:
        type: __expr__
        uid: __expr__
      expression: B
      intervalMs: 1000.0
      maxDataPoints: 43200.0
      refId: C
      type: threshold
    refId: C
    relativeTimeRange: {}
execErrState: OK
folderUID: alerts
for: 10m0s
id: 157
labels:
  alert_type: pod_lifecycle
  environment: mainnet
  severity: warning
  team: platform
noDataState: OK
orgID: 1
provenance: api
ruleGroup: "Mainnet - Pod Lifecycle"
title: StatefulSet High Restart Count
uid: bfd42xy2r1atce
updated: "2026-02-13T11:22:32.000Z"
